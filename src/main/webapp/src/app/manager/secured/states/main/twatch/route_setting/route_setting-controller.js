'use strict';/** * Create namespace. */goog.provide('jxmgrsec.main.twatch.route_setting.Ctrl');/** * main.twatch.route_setting controller. * * @constructor * @export */jxmgrsec.main.twatch.route_setting.Ctrl.$inject = [  "$rootScope",  "$scope",  "$http",  "$modal",  "i18nService",  "ModalService",  "twatch",  "constants",  "$timeout"];jxmgrsec.main.twatch.route_setting.Ctrl = function(  $rootScope,  $scope,  $http,  $modal,  $timeout,  i18nService,  ModalService,  twatch,  constants) {  var ctrl=this;    $scope.gridPieroids = {    paginationPageSizes: [10, 20, 30],    paginationPageSize: 30,  };  i18nService.setCurrentLang('zh-CN');  $scope.gridPieroids.columnDefs = [{    field:'route_period_id',    name: '时段编号',    width: '10%',    pinnedLeft: true  }, {    field:'start',    name: '开始时间',    width: '20%'  },{    field:'stop',    name: '结束时间',    width: '20%',  },{    field:'weeks',    name:'星期几',    width:'10%',    cellFilter: 'mapWeekDays'  },{    field:'set_en',    name:'激活状态',    width:'20%',    cellFilter: 'mapTwatchRouteState'  },{    name:'操作',    width:'20%',    cellTemplate:'<div class="row"><div class="col-md-offset-1 col-md-2 text-center"><button class="btn btn-primary btn-xs" ng-click="grid.appScope.modifyPieroid(row.entity)" >修改</button></div><div class="col-md-offset-2 col-md-2 text-center"><button class="btn btn-primary btn-xs" ng-click="grid.appScope.deletePieroid(row.entity)">删除</button></div></div>'  }];  $scope.gridPieroids.enableFiltering = false;  $scope.gridPieroids.enableCellEdit = false;  // $scope.gridPieroids.data = [{  //   'route_period_id':'1',  //   'start': '08:00',  //   'stop':'19:00',  //   'weeks':'3',  //   'set_en':'已启用'      // }, {  //   'route_period_id':'2',  //   'start': '11:00',  //   'stop':'12:00',  //   'weeks':'1,2,3',  //   'set_en':'已启用'  // }, {  //   'route_period_id':'3',  //   'start': '11:00',  //   'stop':'12:00',  //   'weeks':'3',  //   'set_en':'已启用'  // } ];  /**   * @type {String}   * @nocollapse   */    $scope.gridPieroids.onRegisterApi=function(gridApi) {            $scope.gridApi = gridApi;            $scope.gridApi.core.on.sortChanged($scope, function(grid, sortColumns) {            });  }  /**   * @type {String}   * @nocollapse   */  this.label = 'some other label from main.twatch.route_setting controller';      ctrl.twatch_gps_mode = constants.gotGPSMODES();  ctrl.twatch_gps_mode_id = 1;    ctrl.twatch_route_state = constants.gotROUTESTATES();  ctrl.twatch_route_state_id = 1;  console.log(constants.gotROUTESTATES());  var min = [];  for(var i=1;i<=60;i++){    min.push(i);  }  ctrl.gps_interval = 1;  $scope.minutes = min;  ctrl.imei1 = $rootScope.imei;  ctrl.imei2 = undefined;       $scope.queryFile = function(){    //console.log(ctrl.defaultmode_selected);      twatch.getRouteset({imei:ctrl.imei1}).then(function(data){      $scope.gridPieroids.data = data.periods;      ctrl.imei2 = ctrl.imei1;//      $rootScope.imei = ctrl.imei1;      $rootScope.imeiChanged(ctrl.imei1);      ctrl.gps_interval = data.gps_interval;      ctrl.twatch_route_state_id = data.route_en;      ctrl.twatch_gps_mode_id = data.gps_mode;    },function(error){      $scope.addAlert("danger", error.faultstring);    });  };    $scope.saveRouteSet = function(){    if($scope.validParam(ctrl.imei2)){      var jsonData = {        imei:ctrl.imei2,        route_en:ctrl.twatch_route_state_id,        gps_mode:ctrl.twatch_gps_mode_id,        gps_interval:ctrl.gps_interval      }      console.log(jsonData);      twatch.postRouteset(jsonData).then(function(succ){        $scope.addAlert("success", "保存成功");       },function(error){        console.log(error);        $scope.addAlert("danger", "保存失败，请稍后再试！");      });    }else{      $scope.addAlert("danger", "请先查询！");    }  }  $scope.modifyPieroid = function(entity) {    var modalInstance = $modal.open({      animation: true,      templateUrl: 'components/tpls/modify_route_period_modal/modify_route_period_modal.html',      controller: 'ModifyRoutePeriodModal',      resolve: {        entity: function() {          return entity;        },        imei: function() {          return ctrl.imei2;        }      }    });    modalInstance.result.then(function() {    }, function() {      $scope.queryFile();    });  }  $scope.deletePieroid = function(entity) {    var deleteperiod = {      imei: ctrl.imei2,      route_period_id: entity.route_period_id    }    twatch.deleteRoutePeriod(deleteperiod).then(function(res) {      console.log(res);      $scope.queryFile();    }, function(error) {      console.log(error);    });  }  ctrl.addRoutePieroid = function(entity) {    if($scope.validParam(entity)){    var modalInstance = $modal.open({          animation: true,      templateUrl: 'components/tpls/add_route_period_modal/add_route_period_modal.html',      controller: 'AddRoutePeriodModal',      resolve: {        entity: function() {          return entity;        }      }    });        modalInstance.result.then(function() {    }, function() {      $scope.queryFile();    });  }else{    $scope.addAlert("danger", "请先查询！");  }  }    $scope.validParam = function(param){        if(param != undefined && param != null && param != ""){            return true;        }        return false;    }    //Alert    $scope.alerts = [];    $scope.addAlert = function (type, msg) {        var alert = {'type': type, 'msg': msg};        $scope.alerts.push(alert);        $timeout(function(){            $scope.closeAlert($scope.alerts.indexOf(alert));                 }, 3000);    };    $scope.closeAlert = function(index) {        $scope.alerts.splice(index, 1);    };    $scope.clearAlerts = function() {        $scope.alerts = [];    }; };